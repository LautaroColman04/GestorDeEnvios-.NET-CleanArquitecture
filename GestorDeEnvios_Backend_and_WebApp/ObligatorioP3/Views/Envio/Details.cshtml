@model DTOs.DTOs.DTOsEnvio.DTOEnvio

@{
    ViewData["Title"] = "Detalle del Envío";
}

<section class="min-h-screen bg-gray-50 px-4 py-16">
    <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-md relative">

        <!-- BADGE FLOTANTE -->
        <div class="absolute right-6 top-6">
            <span class="
                px-4 py-1 rounded-full text-xs font-semibold shadow-md
                @(
                    Model.Estado == "Finalizado" ? "bg-green-100 text-green-800" :
                    Model.Estado == "EnProceso" ? "bg-blue-100 text-blue-800" :
                    "bg-gray-100 text-gray-800"
                )">
                Estado: @Model.Estado
            </span>
        </div>

        <!-- Título -->
        <h1 class="text-2xl font-bold text-indigo-700 mb-6 text-center">📦 Detalle del Envío</h1>

        <!-- Mensaje -->
        @if (!string.IsNullOrEmpty(ViewBag.msg as string))
        {
            <div class="bg-green-100 text-green-700 px-4 py-3 rounded-md mb-6 text-sm text-center shadow">
                @ViewBag.msg
            </div>
        }

        <!-- Datos -->
        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-y-4 text-sm text-gray-700 mb-8">
            <div><strong>ID:</strong> @Model.Id</div>
            <div><strong>Tipo:</strong> @Model.TipoEnvio</div>
            <div><strong>Tracking:</strong> @Model.NumTracking</div>
            <div><strong>Cliente ID:</strong> @Model.ClienteId</div>
            <div class="sm:col-span-2"><strong>Dirección Postal:</strong> @Model.DireccionPostal</div>

            @if (Model.TipoEnvio == "URGENTE" && Model.Estado == "Finalizado")
            {
                <div class="sm:col-span-2"><strong>¿Fue Eficiente?</strong> @Model.fueEficiente</div>
            }
            else if (Model.TipoEnvio == "COMUN")
            {
                <div class="sm:col-span-2"><strong>Agencia ID:</strong> @Model.AgenciaId</div>
            }
        </dl>

        <!-- Seguimientos -->
        <div>
            <h2 class="text-lg font-semibold text-indigo-700 mb-4">🕓 Seguimientos</h2>
            <ul class="space-y-3">
                @foreach (var item in Model.DtoSeguimientosEnvio)
                {
                    <li class="bg-gray-50 border border-gray-200 p-4 rounded-md">
                        <div class="font-medium text-gray-800">@item.dtoComentario.UsuarioNombre</div>
                        <p class="text-gray-700 mt-1">@item.dtoComentario.Texto</p>
                        <div class="text-sm text-gray-500 mt-1">@item.dtoComentario.Fecha.ToString()</div>
                    </li>
                }
            </ul>
        </div>

        <!-- Acciones -->
        <div class="mt-8 flex flex-wrap justify-center gap-4">
            @if (Model.Estado == "EnProceso")
            {
                <a asp-action="Finalizar" asp-route-id="@Model.Id" asp-route-origen="@($"Details/{Model.Id}")"
                   class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-md font-medium shadow transition">
                    ✅ Finalizar
                </a>
                <a asp-action="AgregarSeguimiento" asp-route-id="@Model.Id"
                   class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-md font-medium shadow transition">
                    ✏️ Agregar Seguimiento
                </a>
            }
            <a asp-action="Index"
               class="bg-gray-700 hover:bg-gray-800 text-white px-5 py-2 rounded-md font-medium shadow transition">
                ← Volver al Listado
            </a>
        </div>
    </div>
</section>